# 2025年10月31日

ぼちぼち、旧ファームウェアの /RUSP/RUSP.ino から一行ずつ読んで注釈いきますかね。

以降の記事執筆には[Markor](https://github.com/gsantner/markor)を使います。

## 一体全体なにをしているの？

斜め読み程度です。しっかりしたコメントがありますし二百行程度の読みやすい平易なコードなので、難しさはあまり無いかと思います

### void setup()
電源投入時の初期設定です。

* マイコンの初期化と初期設定
  * enableInterrupt()
  * pinMode()
  * digitalWrite() で起動時のベルの鳴動
  * Serial.begin() でシリアルポートの初期化
  * LTEモジュールの初期化
  * 電子ペーパーモジュールの初期化と初期設定
  * SDカードインタフェースの初期化

ピンアサインは RUSP.h と回路図を参照。

### void loop()
いわゆるメインルーチンです。電源オフになるまでループ処理を継続します。

* void rotary_accumulator(): ロータリーダイアルの番号累算処理と架電。本体は helper.ino にあります。
* 待受処理
* 電子ペーパーの処理
  電鈴の鳴動とLEDの点灯
* 各ボタンの処理
* 電池残理監視
* シャットダウン(電源オフ)
* ハングアップ(通話終了)

していることはそれほど難しいことではありません。斜に構えず、ゆっくり調べながら読んでいくといいと思います。

ロータリーダイアルに関しては Rotary dial Github あたりでウェブ検索すると実装例がいくつか見つかります。

## 新旧というより純正ファームウェアではできないこと

今のところ、

* SMS の多言語対応
* インプットメソッドの対応
* 自動着信拒否

などがあります。
これらの制限は Flash ROM や RAM 容量の制約により実装が難しいかもしれません。ただし、往年の8bit PCを参考にすると、SDカードを見立てることで拡張メモリとしてのスワップ領域(いわゆるバンク切り替え)、漢字ROM、辞書ROMなど処理速度を犠牲にすれば実装できるかもしれません。インプットメソッドに関しては物理ボタン数が少ないため実現しても操作性が悪いと考えられます。最悪の場合、ロータリーダイアルでベル打ちになるでしょうし部品にも過剰な負荷がかかり耐久性の高い部材が必要(黒電話以上)になるため、結果として開発や製造コストが跳ね上がるのは想像に難くはありません。

[mozc-dial](https://github.com/google/mozc-devices/blob/main/mozc-dial/buildguide_ja.md)みたいな実装もあることにはありますが。
